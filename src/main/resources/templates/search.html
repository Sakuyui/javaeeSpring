<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>找人结果</title>


<script th:src="@{/static/jquery-3.4.1.js}"></script>
<!-- 最新版本的 Bootstrap 核心 CSS 文件 -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">
<!-- 可选的 Bootstrap 主题文件（一般不用引入） -->
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/css/bootstrap-theme.min.css" integrity="sha384-rHyoN1iRsVXV4nD0JutlnGaslCJuC7uwjduW9SVrLvRYooPp2bWYgmgJQIXwl/Sp" crossorigin="anonymous">

<!-- 最新的 Bootstrap 核心 JavaScript 文件 -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@3.3.7/dist/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>
<!-- Latest compiled and minified CSS -->
<link rel="stylesheet" href="https://unpkg.com/bootstrap-table@1.15.4/dist/bootstrap-table.min.css">

<!-- Latest compiled and minified JavaScript -->
<script src="https://unpkg.com/bootstrap-table@1.15.4/dist/bootstrap-table.min.js"></script>
<!-- Latest compiled and minified Locales -->
<script src="https://unpkg.com/bootstrap-table@1.15.4/dist/locale/bootstrap-table-zh-CN.min.js"></script>
<script src="/static/js/searchUI.js" type="text/javascript" charset="UTF-8"></script>
<link rel="stylesheet" href="/static/css/result.css">

<script type="text/javascript" th:src="@{/js/index.js}"></script>
<script type="text/javascript" src="/static/js/bootstrap-paginator.js"></script>
</head>
<body>
<input type="hidden" th:value="${pages.pages}" id="pagecount"/>
<input type="hidden" th:value="${currpage}" id="currpage"/>
<input type="hidden" th:value="${pzsize}" id="pzsize"/>
<input type="hidden" th:value="${searchstr}" id="sstr"/>

<div align="center">
    <form action="#" th:action="@{/listStudent}" method="post" style="margin-top: 1%">
        <label for="name" class="lable">查询：</label>
        <input id="name" name="name" th:value="${str}" class="searchtxt">
        <button id="search-btn" name="search-btn" class="searchbutton" style="margin-left: 3px">搜索</button>
    </form>

    &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
    <div style="margin-top: 1%;margin-bottom: 2%">
        <a onclick="doAdd()" >添加学生</a>
        &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
        <a th:href="@{/searchstu}">刷新结果</a>
    </div>



    <!--bootstrap表单-->
    <table id="tablestyle" class="table table-bordered tab-content table table-hover table-striped">
        <thead>
        <tr >
            <th th:colspan="1" width="15%">

                <label style="float:left;margin-right: 3%;vertical-align: center">Limit:</label>
                <input type="text" style="width: 15%;float: left;margin-right: 3%" class="form-control" id="pzsizeBox" th:value="${pzsize}">
                <button onclick="doApplyLimit()" type="button" class="RoleOfdelete btn btn-primary  btn-sm" style="margin-left:15px;text-align: right">Apply</button>
            </th>
            <th th:colspan="5" style="text-align: center">搜索结果</th>

        </tr>

        <tr>
            <th style="text-align: center">学号</th>
            <th style="text-align: center">姓名</th>
            <th style="text-align: center">手机号</th>
            <th style="text-align: center">QQ号</th>
            <th style="text-align: center">E-Mail</th>
            <th style="text-align: center" width="8%">操作</th>

        </tr>
        </thead>

        <thead>

        </thead>

        <tr align="center" th:each="list: ${pages.list}">
            <td><a th:href="@{/getUser(id=${list.id})}">[[${list.id}]]</a></td>
            <td th:text="${list.name}"></td>
            <td th:text="${list.phone}"></td>
            <td th:text="${list.qq}"></td>
            <td th:text="${list.email}"></td>

            <td>
                <a th:data-id="${list.id}"
                   th:data-name="${list.name}"
                   th:data-phone="${list.phone}"
                   th:data-qq="${list.qq}"
                   th:data-email="${list.email}"
                   onclick="doUpdate(this,this.getAttribute('data-id'),this.getAttribute('data-name')
                   ,this.getAttribute('data-phone'),this.getAttribute('data-qq'),this.getAttribute('data-email'))">
                <button th:href="${'/admin/updatestu'}" type="button" class="RoleOfdelete btn btn-primary  btn-sm" style="margin-right:15px;">编辑</button>

            </a>
                <a th:data-id="${list.id}"
                   th:data-name="${list.name}"
                   th:data-phone="${list.phone}"
                   th:data-qq="${list.qq}"
                   th:data-email="${list.email}"
                   onclick="doDelete(this,this.getAttribute('data-id'),this.getAttribute('data-name')
                   ,this.getAttribute('data-phone'),this.getAttribute('data-qq'),this.getAttribute('data-email'))">
                <button th:href="${'/admin/deletestu'}" type="button" class="RoleOfdelete btn btn-primary  btn-sm" style="margin-right:15px;">删除</button>
                </a>
            </td>

        </tr>


    </table>



</div>
<!-- 登入模态框（Modal） -->
<div class="modal fade" id="myModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                <h4 class="modal-title" id="myModalLabel">LogIn</h4>
            </div>
            <div class="modal-body">
                <label>在进行操作之前您需要先进行登入以获得操作权限.</label>
                <div>
                    <label style="float: left">账号:</label>
                    <input type="text" class="form-control" placeholder="Account" id="acinput" >
                </div>
                <div>
                    <label style="float: left">密码:</label>
                    <input type="text" class="form-control" placeholder="Password" id="pwdinput">
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
                <button type="button" class="btn btn-primary" onclick="doLogin()">登入</button>
            </div>
        </div><!-- /.modal-content -->
    </div><!-- /.modal -->
</div>


<!-- 插入模态框（Modal） -->
<div class="modal fade" id="myModal2" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                <h4 class="modal-title" id="myModalLabel2">Insert</h4>
            </div>
            <div class="modal-body">
                <label>请填写欲插入的学生信息</label>
                <div>
                    <label style="float: left">学号(*):</label>
                    <input type="text" class="form-control" placeholder="ID" id="stu_code" >
                </div>
                <div>
                    <label style="float: left">姓名(*):</label>
                    <input type="text" class="form-control" placeholder="Name" id="stu_name">
                </div>
                <div>
                    <label style="float: left">手机号(*):</label>
                    <input type="text" class="form-control" placeholder="Phone" id="stu_phone">
                </div>
                <div>
                    <label style="float: left">QQ:</label>
                    <input type="text" class="form-control" placeholder="QQ" id="stu_qq">
                </div>
                <div>
                    <label style="float: left">E-MAIL:</label>
                    <input type="text" class="form-control" placeholder="E-mail" id="stu_email">
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
                <button type="button" class="btn btn-primary" onclick="doAdd('Q')">插入</button>
            </div>
        </div><!-- /.modal-content -->
    </div><!-- /.modal -->
</div>
<!-- 修改模态框（Modal） -->
<div class="modal fade" id="myModal3" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                <h4 class="modal-title" id="myModalLabel3">Update</h4>
            </div>
            <div class="modal-body">
                <label>请填写新的学生信息</label>
                <div>
                    <label style="float: left">学号(*):</label>
                    <input type="text" class="form-control" placeholder="ID" id="stu_codeu" >
                </div>
                <div>
                    <label style="float: left">姓名(*):</label>
                    <input type="text" class="form-control" placeholder="Name" id="stu_nameu">
                </div>
                <div>
                    <label style="float: left">手机号(*):</label>
                    <input type="text" class="form-control" placeholder="Phone" id="stu_phoneu">
                </div>
                <div>
                    <label style="float: left">QQ:</label>
                    <input type="text" class="form-control" placeholder="QQ" id="stu_qqu">
                </div>
                <div>
                    <label style="float: left">E-MAIL:</label>
                    <input type="text" class="form-control" placeholder="E-mail" id="stu_emailu">
                </div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal"
                        onclick=""
                >取消</button>
                <button type="button" class="btn btn-primary" onclick="doUpdate('Q')">修改</button>
            </div>
        </div><!-- /.modal-content -->
    </div><!-- /.modal -->
</div>
<!-- 确认删除模态框（Modal） -->
<div class="modal fade" id="myModal4" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                <h4 class="modal-title" id="myModalLabel4">Delete</h4>
            </div>
            <div class="modal-body">
                <label>确认要从数据库中删除该学生吗?</label>
                <div>
                    <label style="float: left">学号(*):</label>

                    <input type="text" id="stu_coded" >
                </div>
                <div>
                    <label style="float: left">姓名(*):</label>
                    <input type="text" id="stu_named" >
                </div>
                <div>
                    <label style="float: left">手机号(*):</label>
                    <input type="text" id="stu_phoned">
                </div>
                <div>
                    <label style="float: left">QQ:</label>
                    <input type="text" id="stu_qqd">
                </div>
                <div>
                    <label style="float: left">E-MAIL:</label>
                    <input type="text" id="stu_emaild">
                </div>
            </div>


            <div class="modal-footer">
                <button type="button" class="btn btn-default" data-dismiss="modal">取消</button>
                <button type="button" class="btn btn-primary" onclick="doDelete('Q')">确认删除</button>
            </div>
        </div><!-- /.modal-content -->
    </div><!-- /.modal -->
</div>




<div align="center">

    <a th:unless="${pages.isFirstPage}"
       th:href="@{/searchstu(str=${str})}">首 页</a>
    <a th:unless="${pages.isFirstPage}"
       th:href="@{/searchstu(start=${pages.hasPreviousPage}?${pages.prePage}:1, str=${str})}">上一页</a>
    <a th:unless="${pages.isLastPage}"
       th:href="@{/searchstu(start=${pages.hasNextPage}?${pages.nextPage}:${pages.pages}, str=${str})}">下一页</a>
    <a th:unless="${pages.isLastPage}"
       th:href="@{/searchstu(start=${pages.pages}, str=${str})}">末 页</a>
</div>

<nav style="text-align: center;">
    <ul class="pagination" id="paginationBar">

    </ul>
</nav>


<script>


    window.onload=function () {
        var newhtml="";
        var currp=$("#currpage").val();
        var ps=$("#pagecount").val();
        var str=$("#sstr").val();
        var pzs=$("#pzsize").val();
        for (i=0;i<ps;i++){
            if((i+1).toString()==currp.toString()){
                newhtml=newhtml+"<li class=\"active\"><a href=\"/searchstu?start="
                +(i+1).toString()+"&str="+str+"&size="+pzs.toString() + "\">"+(i+1).toString()+"</a></li>"
            }else{
                newhtml=newhtml+"<li><a href=\"/searchstu?start="
                    +(i+1).toString()+"&str="+str+"&size="+pzs.toString() +"\">"+(i+1).toString()+"</a></li>"
            }

        }
        document.getElementById('paginationBar').innerHTML=newhtml;
    }
    window.operateEvents = {
        'click .RoleOfdelete': function (e, value, row, index) {
            alert(row.dno);
        },
        'click .RoleOfedit': function (e, value, row, index) {
            $("#editModal").modal('show');

        }

    };



    function doLogin() {
        d={
            'ac': $("#acinput").val(),
            'pwd':$("#pwdinput").val()
        }
        $.ajax({
            type: "post",
            cache: false,
            contentType:'application/json;charset=utf-8',
            dataType: 'json',
            url:'login',
            data:JSON.stringify(d),
            success:function (datas) {
                //alert('success'+JSON.stringify(datas))
                var c=datas.code;
                if(c!=0){
                    alert("账号或密码错误")
                }else{
                    $('#myModal').modal('hide');
                }
            },
            error:function (jqXHR, textStatus, errorThrown) {
                alert('error'+jqXHR.responseText)
            }

        })
    }



    function doUpdate(a,preid,prename,prephone,preqq,preemail) {
        var d={
            ctype:'update'
        };

        if(a=='Q'){
            //post 到 updatestu 执行修改操作
            //alert('update')
            var nid=$('#stu_codeu').val(); //新姓名
            var nname=$('#stu_nameu').val(); //新名字
            var nqq=$('#stu_qqu').val(); //新qq
            var nemail=$('#stu_emailu').val(); //新email
            var nphone=$('#stu_phoneu').val(); //新phone
            if(typeof(nid)==undefined || typeof(nname)==undefined || typeof(nphone)==undefined ||
                nid=='' || nname=='' || nphone==''){
                alert('必填字段不能为空')
                return;
            }


            var dataset={
                'ctype':'update',
                'nid':nid,
                'nname':nname,
                'nqq':nqq,
                'nemail':nemail,
                'nphone':nphone
            }
            $.ajax(
                {
                    type: "post",
                    cache: false,
                    contentType:'application/json;charset=utf-8',
                    dataType: 'json',
                    url:'admin/updatestu',

                    data:JSON.stringify(dataset),
                    success:function (datas) {
                        alert(JSON.stringify(datas))
                    },
                    error:function (jqXHR, textStatus, errorThrown) {
                        alert(jqXHR.responseText)
                    }
                }
            )
            return;
        }else{

            $.ajax({
                type: "post",
                cache: false,
                contentType:'application/json;charset=utf-8',
                dataType: 'json',
                url:'admin/change',

                data:JSON.stringify(d),
                success:function (datas) {
                    var code=datas.code
                    if(code.toString()=='210'){ //未登入
                        $('#myModal').modal();
                    }
                    if(code.toString()=='0'){   //登入完成
                        document.getElementById("stu_codeu").setAttribute('value',preid);
                        document.getElementById("stu_nameu").setAttribute('value',prename);
                        document.getElementById("stu_phoneu").setAttribute('value',prephone);
                        document.getElementById("stu_qqu").setAttribute('value',preqq);
                        document.getElementById("stu_emailu").setAttribute('value',preemail);
                        $('#myModal3').modal();
                    }
                },
                error:function (jqXHR, textStatus, errorThrown) {
                    alert(jqXHR.responseText)
                }

            })
        }

    }
    function doDelete(a,preid,prename,prephone,preqq,preemail) {
        var d={
            'ctype':'delete'
        };
        if(a=='Q'){
            //post 到 updatestu 执行修改操作
            if(typeof (preid)==undefined || preid=='')
            {
                return;
            }
            var dataset={
                'ctype':'delete',
                'nid':$('#stu_coded').val()
            };

            $.ajax(
                {
                    type: "post",
                    cache: false,
                    contentType:'application/json;charset=utf-8',
                    dataType: 'json',
                    url:'admin/deletestu',

                    data:JSON.stringify(dataset),
                    success:function (datas) {
                        alert(JSON.stringify(datas))
                    },
                    error:function (jqXHR, textStatus, errorThrown) {
                        alert(jqXHR.responseText)
                    }
                }
            )
            //alert('delete')
            return;
        }else {
            $.ajax({
                type: "post",
                cache: false,
                contentType:'application/json;charset=utf-8',
                dataType: 'json',
                url:'admin/change',
                data:JSON.stringify(d),
                success:function (datas) {
                    var code=datas.code
                    if(code.toString()=='210'){
                        $('#myModal').modal();
                    }
                    if(code.toString()=='0'){
                        document.getElementById("stu_coded").setAttribute('value',preid);
                        document.getElementById("stu_named").setAttribute('value',prename);
                        document.getElementById("stu_phoned").setAttribute('value',prephone);
                        document.getElementById("stu_qqd").setAttribute('value',preqq);
                        document.getElementById("stu_emaild").setAttribute('value',preemail);
                        $('#myModal4').modal();
                    }
                },
                error:function (jqXHR, textStatus, errorThrown) {
                    alert(jqXHR.responseText)
                }

            })
        }

    }
    function doAdd(a) {
        var d={
            'ctype':'add'
        };
        //alert(11)

        if(a=='Q'){
            //post 到 updatestu 执行修改操作
            //alert('add')

            var nid=$('#stu_code').val(); //新姓名
            var nname=$('#stu_name').val(); //新名字
            var nqq=$('#stu_qq').val(); //新qq
            var nemail=$('#stu_email').val(); //新email
            var nphone=$('#stu_phone').val(); //新phone
            if(typeof(nid)==undefined || typeof(nname)==undefined || typeof(nphone)==undefined ||
                nid=='' || nname=='' || nphone==''){
                alert('必填字段不能为空')
                return;
            }


            var dataset={
                'ctype':'add',
                'nid':nid,
                'nname':nname,
                'nqq':nqq,
                'nemail':nemail,
                'nphone':nphone
            }
            $.ajax(
                {
                    type: "post",
                    cache: false,
                    contentType:'application/json;charset=utf-8',
                    dataType: 'json',
                    url:'admin/addstu',

                    data:JSON.stringify(dataset),
                    success:function (datas) {
                        alert(JSON.stringify(datas))
                    },
                    error:function (jqXHR, textStatus, errorThrown) {
                        alert(jqXHR.responseText)
                    }
                }
            )
            return;
        }else {
            //alert(22)

            $.ajax({
                type: "post",
                cache: false,
                contentType:'application/json;charset=utf-8',
                dataType: 'json',
                url:'admin/change',
                data:JSON.stringify(d),
                success:function (datas) {
                    //alert('success')
                    var code=datas.code
                    if(code.toString()=='210'){
                        $('#myModal').modal();
                    }
                    if(code.toString()=='0'){
                        $('#myModal2').modal();
                    }

                },
                error:function (jqXHR, textStatus, errorThrown) {
                    alert(jqXHR.responseText)
                }

            })
        }

    }
    function doApplyLimit() {
        var limit=document.getElementById('pzsizeBox').value;
        var ps=$("#pzsize").val();
        var curpage=$("#currpage").val();
        var totlepages=$("#pagecount").val();
        if (!(/(^[1-9]\d*$)/.test(limit))) {
            alert("输入错误");
            return;
        }
        if(limit!=ps){
            //计算页数
            var ecount=ps*curpage;  //当前显示最远项
            var scount=ps*(curpage-1)+1; //当前显示最前项
            var totle=totlepages*ps; //总项
            var npzsize=$("#pzsizeBox").val();
            var p=(Math.ceil(scount/npzsize));
            window.location.href="/searchstu?start="+p.toString()+"&str="+$("#sstr").val()+"&size="+npzsize.toString();



        }
    }



</script>




</body>


</html>